{% ckan_extends %}
{% block disclaimer %}
{% endblock %}

{% block basic_fields %}
  {%- if not dataset_type -%}
    <p>
    dataset_type not passed to template. your version of CKAN
    might not be compatible with ckanext-scheming
    </p>
  {%- endif -%}
  {%- set schema = h.scheming_get_dataset_schema(dataset_type) -%}
  {%- for field in schema.dataset_fields -%}
    {% if field.section_title %}
       <h2 id="{{ "ogdch_" + field.field_name + "_pagemark" }}">
           {{ _("{section_title}").format(section_title=field.section_title) }}
       </h2>
    {% endif %}
    {% if field.subheader %}
      <h3>
      {% if field.mark_required %}
          <span title="{{ _('This field is required') }}" class="control-required">*</span>
      {% endif %}
          {{ field.subheader }}
      </h3>
      {% if field.ogdch_help_text %}
          <p>{{ field.ogdch_help_text }}</p>
      {% endif %}
    {% endif %}
    {%- if field.form_snippet is not none -%}
      {%- snippet 'scheming/snippets/form_field.html',
        field=field, data=data, errors=errors, licenses=c.licenses,
        entity_type='dataset', object_type=dataset_type -%}
    {%- endif -%}
  {%- endfor -%}

  {% set groups = h.get_localized_group_list(lang) %}
  {% if groups %}
    <h2 id="{{ "ogdch_groups" + "_pagemark" }}">
           {{ _("Categories") }}
       </h2>
    <div class="form-group control-medium">
      <div class="controls">
        {% for group in groups %}
          <label class="checkbox" for="field-group-{{ loop.index0 }}">
            <input id="field-group-{{ loop.index0 }}" type="checkbox" name="groups__{{ loop.index0 }}__id" value="{{ group.id }}" {% if h.group_id_in_groups(group.id, data.get('groups', [])) %}checked{% endif %} />
            {{ group.title }}
          </label>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {%- if 'resource_fields' not in schema -%}
    <!-- force controller to skip resource-editing step for this type -->
    <input type="hidden" name="_ckan_phase" value="" />
  {%- endif -%}
{% endblock %}
